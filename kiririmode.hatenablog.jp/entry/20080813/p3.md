---
Title: STP (Spanning Tree Protocol)
Category:
- study
Date: 2008-08-13T00:00:02+09:00
URL: https://kiririmode.hatenablog.jp/entry/20080813/p3
EditURL: https://blog.hatena.ne.jp/kiririmode/kiririmode.hatenablog.jp/atom/entry/8454420450078214411
---

STP は DEC によって開発されたスイッチングループ防止用のプロトコル．現在の実装は IEEE 802.1d 準拠が主体．

**STP の動作の流れ
+ルートブリッジ選択
最小のブリッジ ID を持つスイッチがルートブリッジとして選択される．ブリッジ ID はプライオリティ (デフォルトで 0x8000) に MAC アドレスを加えたもの．BPDU (Bridge Protocol Data Unit) によって運ばれる
+非ルートブリッジの RP (Root Port) 選択
非ルートブリッジに，それぞれ一つずつ RP を定める．RP は，非ルートブリッジの持つインタフェースのうち，ルートブリッジへのパスコストが最小となるもの．必ずフォワーディング状態になる．パスコストは以下のように決められる．
|*帯域幅|*旧コスト|*新コスト|
|10Gbps|1       |2       |
|1Gbps |1       |4       |
|100Mbps|10     |19      |
|10Mbps |100    |100     |
+各セグメントに DP (Designated Port) を選出
DP は各セグメントの中で，もっともルートブリッジに近いポート．DP は必ずフォワーディング状態になる．
+非指定ポートを決める
RP でも DP でもないポートはぜんぶ非指定ポート．ぜんぶ! ぜんぶブロッキング状態!

**STP のポート

ルートブリッジは 2 秒ごとに BPDU を流し，各スイッチはそれを受信することで経路が正常であることを確かめる．(デフォルトで) 20 秒間 BPDU が届かなくなると，STP は再計算を始める．ブロッキング状態のポートが，フォワーディング状態になるには以下の過程を踏む．
+ブロッキング
 再計算を開始するまで 20 秒間待機．
+リスニング (15 秒)
 BPDU を交換する状態．MAC アドレスは学習しない．
+ラーニング (15 秒)
 BPDU を交換する状態．MAC アドレスを学習するようになる．
+フォワーディング
 フレーム転送を行う．

**状態確認

>||
# show spanning-tree [vlan vlan-id]
||<
