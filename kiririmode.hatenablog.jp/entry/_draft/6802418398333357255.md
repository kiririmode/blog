---
Title: syftとgrypeでJavaとNode.jsプロジェクトの依存関係と脆弱性を可視化する
Category:
- Security
- Development
- Java
- Node.js
- SBOM
Date: 2025-03-03T03:52:01Z
URL: https://kiririmode.hatenablog.jp/entry/20250303/1709436721
EditURL: https://blog.hatena.ne.jp/kiririmode/kiririmode.hatenablog.jp/atom/entry/6802418398333357255
---

最近、オープンソースソフトウェアを利用したサプライチェーン攻撃が増加しており、プロジェクトの依存関係管理と脆弱性対策の重要性が高まっています。僕自身、開発プロジェクトで数多くの依存パッケージを利用していますが、それらの依存関係を可視化し、潜在的な脆弱性を検知する必要性を感じていました。

今回は、syftとgrypeという2つのツールを使って、JavaプロジェクトのPOM（pom.xml）とNode.jsプロジェクトのpackage.jsonから依存関係を可視化し、脆弱性を検知する方法を紹介します。

[:contents]

# syftとgrypeとは

## syft：依存関係の可視化ツール
syftは、Anchore社が開発したソフトウェアコンポーネントの依存関係を分析し、SBOMを生成するツールです。SBOMとは「Software Bill of Materials」の略で、ソフトウェアの構成要素を一覧化したものとなります。

以下のような特徴があります。

- 多様なパッケージマネージャーのサポート（Maven、npm、etc）
- 複数のフォーマット（JSON、SPDX、CycloneDX）でのSBOM生成
- コンテナイメージの解析にも対応
- 実行が高速

## grype：脆弱性スキャンツール
grypeもAnchore社が開発した脆弱性スキャンツールで、syftと連携して動作します。主な特徴は以下の通りです。

- 最新の脆弱性データベースを活用
- 重要度に基づく脆弱性の分類
- 豊富な出力フォーマット
- 高速な脆弱性スキャン

# ローカルでの環境構築

## インストール
まず、syftとgrypeをローカルPCにインストールします。

```bash
# syftのインストール
curl -sSfL https://raw.githubusercontent.com/anchore/syft/main/install.sh | sh -s -- -b /usr/local/bin

# grypeのインストール
curl -sSfL https://raw.githubusercontent.com/anchore/grype/main/install.sh | sh -s -- -b /usr/local/bin
```

インストールが完了したら、バージョンを確認します。

```bash
syft version
grype version
```

# Javaプロジェクト（pom.xml）の解析

## 実際のプロジェクトでの依存関係の可視化
まず、手元のJavaプロジェクトの依存関係を解析してみましょう。以下は、Spring Bootプロジェクトを例にしています。

```bash
cd /path/to/java-project
syft .
```

このコマンドを実行すると、以下のような形式でプロジェクトの依存関係が表示されます。

```text
 ✓ Indexed /path/to/java-project
 ✓ Cataloged packages [123 packages]

NAME                    VERSION      TYPE
spring-boot-starter-web 2.7.0       java-archive
spring-core            5.3.20       java-archive
jackson-databind       2.13.3       java-archive
...
```

より詳細な情報をJSON形式で出力することもできます。

```bash
syft . -o json > java-dependencies.json
```

## 脆弱性の検知
続いて、grypeを使って脆弱性をスキャンします。

```bash
cd /path/to/java-project
grype .
```

実行すると、以下のような形式で脆弱性が表示されます。

```text
 ✓ Vulnerability DB        [updated]
 ✓ Indexed /path/to/java-project
 ✓ Scanned image          [31 vulnerabilities]

NAME           INSTALLED  FIXED-IN   VULNERABILITY   SEVERITY
spring-core    5.3.18    5.3.19     CVE-2022-22965 High
jackson-core   2.13.2    2.13.2.1   CVE-2020-36518 Medium
...
```

特定の重要度以上の脆弱性のみを表示することもできます。

```bash
grype . --fail-on high
```

# Node.jsプロジェクト（package.json）の解析

## 依存関係の可視化
Node.jsプロジェクトも同様に解析できます。

```bash
cd /path/to/node-project
syft .
```

package.jsonとpackage-lock.jsonから依存関係が表示されます。

```text
 ✓ Indexed /path/to/node-project
 ✓ Cataloged packages [89 packages]

NAME         VERSION     TYPE
express     4.17.1      npm
lodash      4.17.21     npm
moment      2.29.1      npm
...
```

## 脆弱性の検知
package.jsonに記載された依存パッケージの脆弱性をスキャンします。

```bash
cd /path/to/node-project
grype .
```

出力例：
```text
 ✓ Vulnerability DB        [updated]
 ✓ Indexed /path/to/node-project
 ✓ Scanned image          [15 vulnerabilities]

NAME      INSTALLED  FIXED-IN  VULNERABILITY   SEVERITY
minimist  1.2.5      1.2.6    CVE-2020-7598  Critical
moment    2.29.1     2.29.2   CVE-2022-24785 High
...
```

# 実践的な使用のポイント

## 脆弱性対応の優先順位付け
grypeは脆弱性の重要度（CRITICAL、HIGH、MEDIUM、LOW）を表示します。以下の観点で対応の優先順位を決めることができます。

- 重要度レベル
- 影響を受けるコンポーネントの重要性
- 修正の容易さ
- 実際のエクスプロイト可能性

## 定期的なスキャンの習慣化
以下のようなタイミングでのスキャンを習慣化することを推奨します。

- 新しいパッケージを追加する前
- パッケージのバージョンを更新する前後
- プロジェクトの定期メンテナンス時
- セキュリティアラートを受け取ったとき

## 出力形式の活用
syftとgrypeは複数の出力形式をサポートしています。用途に応じて使い分けましょう。

```bash
# syftの出力形式
syft . -o json    # JSON形式
syft . -o table   # テーブル形式
syft . -o spdx    # SPDX形式

# grypeの出力形式
grype . -o json   # JSON形式
grype . -o table  # テーブル形式
```

# まとめ

syftとgrypeを活用することで、以下のメリットが得られます：

- プロジェクトの依存関係の可視化が容易に
- 潜在的な脆弱性を素早く発見可能
- 脆弱性の重要度に基づく対応の優先順位付けが可能
- 定期的なセキュリティチェックの自動化

特にJavaとNode.jsのプロジェクトでは、数多くの依存パッケージを使用することが一般的なため、これらのツールによる継続的な監視が重要です。今回紹介した方法を活用して、プロジェクトのセキュリティ管理を効率的に行っていきましょう。

# 参考文献

> [https://github.com/anchore/syft:embed]

> [https://github.com/anchore/grype:embed]
